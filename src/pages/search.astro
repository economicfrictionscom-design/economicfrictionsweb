---
import BaseLayout from '../layouts/BaseLayout.astro';
---

<BaseLayout title="Search" description="Search Economic Frictions">
  <section class="max-w-4xl mx-auto mt-8">
    <h1 class="text-3xl font-serif font-bold text-stone-900 dark:text-stone-100 mb-8">Search</h1>
    
    <div class="relative mb-8">
      <input 
        type="text" 
        id="search-input" 
        placeholder="Type to search articles..." 
        class="w-full p-4 pl-12 rounded-lg border border-stone-300 dark:border-stone-700 bg-white dark:bg-stone-800 text-stone-900 dark:text-stone-100 focus:ring-2 focus:ring-blue-500 outline-none transition-colors text-lg"
      />
      <svg class="w-6 h-6 text-stone-400 absolute left-4 top-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
    </div>

    <ul id="search-results" class="space-y-6"></ul>
    <p id="no-results" class="hidden text-stone-500 text-center mt-8">No posts found.</p>
  </section>

  <script is:inline>
    let posts = [];
    fetch('/search.json').then(res => res.json()).then(data => { posts = data; });

    const searchInput = document.getElementById('search-input');
    const resultsList = document.getElementById('search-results');
    const noResults = document.getElementById('no-results');

    searchInput.addEventListener('input', (e) => {
      const term = e.target.value.toLowerCase();
      resultsList.innerHTML = '';
      
      if (term.length < 2) {
        noResults.classList.add('hidden');
        return;
      }

      const filtered = posts.filter(post => 
        post.title.toLowerCase().includes(term) || 
        post.description.toLowerCase().includes(term) ||
        (post.tags && post.tags.some(tag => tag.toLowerCase().includes(term)))
      );

      if (filtered.length === 0) {
        noResults.classList.remove('hidden');
      } else {
        noResults.classList.add('hidden');
        filtered.forEach(post => {
          const date = new Date(post.date).toLocaleDateString('en-US', {year: 'numeric', month: 'short', day: 'numeric'});
          const item = document.createElement('li');
          item.innerHTML = `
            <a href="${post.slug}" class="block p-6 bg-white dark:bg-[#1d1e20] border border-stone-200 dark:border-stone-700 rounded-lg hover:border-blue-500 transition-colors">
              <h3 class="text-xl font-serif font-bold text-stone-900 dark:text-stone-100 mb-2">${post.title}</h3>
              <p class="text-stone-600 dark:text-stone-400 text-sm mb-2">${post.description}</p>
              <span class="text-xs font-mono text-stone-400 uppercase">${date}</span>
            </a>
          `;
          resultsList.appendChild(item);
        });
      }
    });
  </script>
</BaseLayout>