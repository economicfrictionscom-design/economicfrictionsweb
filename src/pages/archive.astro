---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const posts = (await getCollection('blog')).sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);

// Grouping posts by year for a cleaner look
const years = [...new Set(posts.map(post => post.data.pubDate.getFullYear()))];
---

<BaseLayout title="Archive" description="Full collection of Economic Frictions analysis.">
  <div class="max-w-4xl mx-auto">
    <header class="mb-16 border-b border-slate-200 dark:border-slate-800 pb-8">
      <h1 class="text-4xl md:text-5xl font-serif font-bold text-slate-900 dark:text-white mb-4">
        Archive
      </h1>
      <p class="text-slate-500 dark:text-slate-400 font-serif italic">
        A chronological history of market frictions and economic observations.
      </p>
    </header>

    <div class="space-y-16">
      {years.map(year => (
        <section>
          <div class="flex items-center mb-8">
            <h2 class="text-2xl font-serif font-bold text-amber-600 dark:text-amber-500">{year}</h2>
            <div class="flex-grow border-t border-slate-100 dark:border-slate-900 ml-6"></div>
          </div>
          
          <ul class="space-y-8">
            {posts.filter(post => post.data.pubDate.getFullYear() === year).map(post => (
              <li class="group">
                <a href={`/economicfrictionsweb/blog/${post.slug}`} class="flex flex-col md:flex-row md:items-baseline justify-between gap-2 md:gap-8">
                  <h3 class="text-xl font-serif font-bold text-slate-800 dark:text-slate-200 group-hover:text-amber-600 transition-colors leading-tight">
                    {post.data.title}
                  </h3>
                  <div class="flex-shrink-0 text-sm font-mono text-slate-400">
                    {post.data.pubDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}
                  </div>
                </a>
                <p class="mt-2 text-slate-500 dark:text-slate-500 text-sm line-clamp-2 font-serif max-w-2xl">
                  {post.data.description}
                </p>
              </li>
            ))}
          </ul>
        </section>
      ))}
    </div>
  </div>
</BaseLayout>