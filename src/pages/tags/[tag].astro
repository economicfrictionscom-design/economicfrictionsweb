---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';

export async function getStaticPaths() {
  const allPosts = await getCollection('blog');
  const uniqueTags = [...new Set(allPosts.map((post) => post.data.tags).flat())];

  return uniqueTags.map((tag) => {
    const filteredPosts = allPosts.filter((post) => post.data.tags.includes(tag));
    return {
      params: { tag },
      props: { posts: filteredPosts },
    };
  });
}

const { tag } = Astro.params;
const { posts } = Astro.props;
---

<BaseLayout title={`Posts tagged with ${tag}`}>
  <section class="max-w-4xl mx-auto">
    
    <div class="mb-12 border-b border-stone-200 dark:border-stone-700 pb-8">
      <h1 class="text-3xl font-serif font-bold text-stone-900 dark:text-stone-100">
        <span class="text-stone-400 font-light">Topic:</span> #{tag}
      </h1>
    </div>

    <ul class="space-y-12">
      {posts.map((post) => (
        <li class="group">
          <a href={`/blog/${post.slug}/`} class="block">
            <h2 class="text-2xl font-serif font-bold text-stone-900 dark:text-stone-100 group-hover:text-blue-700 dark:group-hover:text-blue-400 transition-colors mb-2">
              {post.data.title}
            </h2>
            <div class="text-sm font-mono text-stone-400 dark:text-stone-500">
              {post.data.pubDate.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
              })}
            </div>
          </a>
        </li>
      ))}
    </ul>

  </section>
</BaseLayout>