---
---
<div 
  id="floating-subscribe" 
  class="fixed bottom-6 right-6 z-40 transform transition-all duration-500 translate-y-0 opacity-100"
>
  <div class="relative group">
    <div class="absolute -top-12 -right-12 w-24 h-24 bg-amber-400/20 rounded-full blur-xl group-hover:bg-amber-400/30 transition-colors pointer-events-none"></div>
    
    <div class="relative bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 p-6 rounded-2xl shadow-2xl max-w-xs">
      <button 
        id="close-subscribe" 
        class="absolute top-2 right-2 text-slate-400 hover:text-slate-600 dark:hover:text-slate-200"
        aria-label="Close"
      >
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>

      <h3 class="font-serif font-bold text-lg text-slate-900 dark:text-white mb-2 pr-4">
        Economic Frictions
      </h3>
      <p class="text-xs text-slate-500 dark:text-slate-400 mb-4 leading-relaxed">
        Analysis of the hidden mechanisms shaping markets.
      </p>

      <form
        action="https://buttondown.email/api/emails/embed-subscribe/devansh"
        method="post"
        target="popupwindow"
        onsubmit="window.open('https://buttondown.email/api/emails/embed-subscribe/devansh', 'popupwindow')"
        class="flex flex-col gap-2"
      >
        <input
          type="email"
          name="email"
          placeholder="Email address"
          required
          class="w-full px-3 py-2 text-sm rounded-lg border border-slate-300 dark:border-slate-700 bg-slate-50 dark:bg-slate-800 focus:border-amber-500 outline-none"
        />
        <button
          type="submit"
          class="w-full px-4 py-2 bg-slate-900 dark:bg-white text-white dark:text-slate-900 text-sm font-bold rounded-lg hover:bg-amber-600 dark:hover:bg-amber-400 transition-colors"
        >
          Subscribe
        </button>
      </form>
    </div>
  </div>
</div>

<script is:inline>
  const floatingBox = document.getElementById('floating-subscribe');
  const closeBtn = document.getElementById('close-subscribe');
  // Target the static subscribe section specifically
  const staticSection = document.getElementById('static-subscribe-section');
  const footer = document.querySelector('footer');

  // 1. Close Button Logic
  if (closeBtn && floatingBox) {
    closeBtn.addEventListener('click', () => {
      floatingBox.classList.add('hidden');
      localStorage.setItem('subscribe-hidden', 'true');
    });
  }

  // 2. Check if user already closed it
  if (localStorage.getItem('subscribe-hidden') === 'true' && floatingBox) {
    floatingBox.classList.add('hidden');
  }

  // 3. Smart Scroll Logic
  window.addEventListener('scroll', () => {
    if (!floatingBox || floatingBox.classList.contains('hidden')) return;

    const windowHeight = window.innerHeight;
    let shouldHide = false;

    // Check if Static Subscribe is visible
    if (staticSection) {
      const staticRect = staticSection.getBoundingClientRect();
      // If the top of the static section is appearing in the window
      if (staticRect.top < windowHeight - 100) { 
        shouldHide = true;
      }
    }

    // Fallback: Check Footer (just in case)
    if (footer) {
      const footerRect = footer.getBoundingClientRect();
      if (footerRect.top < windowHeight) {
        shouldHide = true;
      }
    }

    // Apply visibility
    if (shouldHide) {
      floatingBox.classList.add('translate-y-20', 'opacity-0', 'pointer-events-none');
    } else {
      floatingBox.classList.remove('translate-y-20', 'opacity-0', 'pointer-events-none');
    }
  });
</script>